FROM php:8.3

WORKDIR /usr/src/app

RUN apt-get update --yes --quiet

# Installing webp
RUN apt-get install webp --yes --quiet

RUN docker-php-ext-install bcmath
RUN docker-php-ext-install ctype

RUN apt-get install libonig-dev --yes --quiet # Required by mbstring
RUN docker-php-ext-install mbstring

RUN docker-php-ext-install pdo
RUN docker-php-ext-install pdo_mysql # We use MySQL

RUN apt-get install libxml2-dev --yes --quiet # Required by xml
RUN docker-php-ext-install xml

RUN apt update && apt install -y --no-install-recommends \
        libjpeg62-turbo-dev \
        libmagickwand-dev \
        libwebp-dev \
        libpng-dev && \
    rm -rf /var/lib/apt/lists/*

RUN docker-php-ext-configure gd --with-webp=/usr --with-jpeg=/usr
RUN docker-php-ext-install gd

RUN pecl install xdebug-3.3.2
RUN docker-php-ext-enable xdebug


RUN apt update && apt install -y --no-install-recommends \
        libzip-dev \
        zip \
        unzip \
  && docker-php-ext-install zip

# Install Imagick
# RUN apt-get update && apt-get install -y --no-install-recommends \
#        libmagickwand-dev \
#        imagemagick \
#        libmagickcore-dev && \
#    pecl install imagick && \
#    docker-php-ext-enable imagick

# Clean up
# RUN apt-get clean && rm -rf /var/lib/apt/lists/*

# RUN apt update && apt install -y --no-install-recommends ghostscript 
# RUN sed -i '/disable ghostscript format types/,+6 s/rights="none"/rights="read|write"/' /etc/ImageMagick-6/policy.xml
